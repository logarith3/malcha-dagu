This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
Dockerfile
eslint.config.js
index.html
nginx.conf
package.json
public/vite.svg
README.md
src/App.css
src/App.tsx
src/assets/daguLoading.gif
src/assets/react.svg
src/components/ItemCard.tsx
src/components/MatchaBounceLoader.tsx
src/components/SearchBar.tsx
src/components/VSComparisonLayout.tsx
src/hooks/useAuth.ts
src/hooks/useSearch.ts
src/index.css
src/main.tsx
src/pages/HomePage.tsx
src/pages/SearchResultPage.tsx
src/services/api.ts
src/types/index.ts
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="Dockerfile">
# Frontend Dockerfile
FROM node:20-alpine AS builder

WORKDIR /app

# Install dependencies
COPY package*.json ./
RUN npm ci

# Copy source and build
COPY . .
RUN npm run build

# Production stage with nginx
FROM nginx:alpine

# Copy built assets
COPY --from=builder /app/dist /usr/share/nginx/html

# Copy nginx config
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DAGU</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="nginx.conf">
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;

    # SPA fallback
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API proxy
    location /api/ {
        proxy_pass http://backend:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
</file>

<file path="package.json">
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@tailwindcss/vite": "^4.1.18",
    "@tanstack/react-query": "^5.90.17",
    "axios": "^1.13.2",
    "framer-motion": "^12.26.2",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0",
    "tailwindcss": "^4.1.18"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
/**
 * MALCHA-DAGU Main App
 */

import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import HomePage from './pages/HomePage';
import SearchResultPage from './pages/SearchResultPage';

// React Query í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5ë¶„
      gcTime: 10 * 60 * 1000,   // 10ë¶„
      retry: 1,
      refetchOnWindowFocus: false,
    },
  },
});

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<HomePage />} />
          <Route path="/search" element={<SearchResultPage />} />
        </Routes>
      </BrowserRouter>
    </QueryClientProvider>
  );
}

export default App;
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/ItemCard.tsx">
/**
 * Item Card Component
 *
 * Features:
 * - ê°€ê²© ë° í• ì¸ìœ¨ í‘œì‹œ
 * - ì¶œì²˜ ë±ƒì§€
 * - Layout ì• ë‹ˆë©”ì´ì…˜ (ìˆœìœ„ ë³€ê²½ ì‹œ)
 * - í´ë¦­ ì‹œ ë§í¬ ì´ë™
 * - ì‹ ê³ í•˜ê¸° / ê°€ê²© ì—…ë°ì´íŠ¸ ë²„íŠ¼ (ìœ ì € ë§¤ë¬¼ë§Œ)
 */

import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import type { NaverItem, MergedUserItem, ReportReason } from '../types';
import { REPORT_REASON_LABELS } from '../types';

interface ItemCardProps {
    item: NaverItem | MergedUserItem;
    rank?: number;
    referencePrice?: number;
    onClick?: () => void;
    isOwner?: boolean;
    isLoggedIn?: boolean;
    onExtend?: () => void;
    onReport?: (reason: ReportReason, detail?: string) => void;
    onUpdatePrice?: (newPrice: number) => void;
}

// ì¶œì²˜ë³„ ìŠ¤íƒ€ì¼
const SOURCE_STYLES: Record<string, { bg: string; text: string; label: string }> = {
    naver: { bg: 'bg-green-100', text: 'text-green-700', label: 'ë„¤ì´ë²„' },
    mule: { bg: 'bg-blue-100', text: 'text-blue-700', label: 'ë®¬' },
    bunjang: { bg: 'bg-red-100', text: 'text-red-700', label: 'ë²ˆê°œì¥í„°' },
    joonggonara: { bg: 'bg-green-100', text: 'text-green-700', label: 'ì¤‘ê³ ë‚˜ë¼' },
    danggn: { bg: 'bg-orange-100', text: 'text-orange-700', label: 'ë‹¹ê·¼' },
    other: { bg: 'bg-stone-100', text: 'text-stone-700', label: 'ê¸°íƒ€' },
};

function formatPrice(price: number): string {
    return new Intl.NumberFormat('ko-KR').format(price);
}

function calculateDiscount(price: number, referencePrice: number): number {
    if (referencePrice <= 0) return 0;
    return Math.round((1 - price / referencePrice) * 100);
}

// ê¸°íƒ€ í”¼í¬ ìˆœìœ„ ì•„ì´ì½˜
function PickIcon({ rank }: { rank: number }) {
    const colors = {
        1: { fill: '#FFD700', stroke: '#B8860B', text: '#8B4513' }, // ê³¨ë“œ
        2: { fill: '#C0C0C0', stroke: '#808080', text: '#404040' }, // ì‹¤ë²„
        3: { fill: '#CD7F32', stroke: '#8B4513', text: '#FFFFFF' }, // ë¸Œë¡ ì¦ˆ
    };
    const color = colors[rank as 1 | 2 | 3] || colors[3];

    return (
        <svg viewBox="0 0 100 100" className="w-8 h-8 drop-shadow-md">
            {/* í”¼í¬ ëª¸í†µ */}
            <path
                d="M 50 98 C 85 80, 95 30, 85 15 C 75 5, 25 5, 15 15 C 5 30, 15 80, 50 98 Z"
                fill={color.fill}
                stroke={color.stroke}
                strokeWidth="3"
            />
            {/* ìˆœìœ„ ìˆ«ì */}
            <text
                x="50"
                y="55"
                textAnchor="middle"
                fill={color.text}
                fontSize="32"
                fontWeight="bold"
                fontFamily="system-ui, sans-serif"
            >
                {rank}
            </text>
        </svg>
    );
}

export default function ItemCard({
    item,
    rank,
    referencePrice,
    onClick,
    isOwner,
    isLoggedIn,
    onExtend,
    onReport,
    onUpdatePrice,
}: ItemCardProps) {
    const [showReportModal, setShowReportModal] = useState(false);
    const [showPriceModal, setShowPriceModal] = useState(false);
    const [reportReason, setReportReason] = useState<ReportReason>('wrong_price');
    const [newPrice, setNewPrice] = useState(item.lprice.toString());

    const source = item.source || 'other';
    const sourceStyle = SOURCE_STYLES[source] || SOURCE_STYLES.other;
    const mallName = 'mallName' in item ? item.mallName : ('source_display' in item ? item.source_display : '');

    // ìœ ì € ë§¤ë¬¼ì¸ì§€ í™•ì¸ (id í•„ë“œ ì¡´ì¬ ì—¬ë¶€ë¡œ íŒë‹¨)
    const isUserItem = 'id' in item && source !== 'naver';

    // í• ì¸ìœ¨ ê³„ì‚°
    const discount = 'discount_rate' in item
        ? item.discount_rate
        : referencePrice
            ? calculateDiscount(item.lprice, referencePrice)
            : 0;

    // ì´ë¯¸ì§€ URL
    const imageUrl = 'image' in item ? item.image : '';

    const handleClick = () => {
        window.open(item.link, '_blank', 'noopener,noreferrer');
        onClick?.();
    };

    const handleExtend = (e: React.MouseEvent) => {
        e.stopPropagation();
        onExtend?.();
    };

    const handleReportClick = (e: React.MouseEvent) => {
        e.stopPropagation();
        // ë¡œê·¸ì¸ ì—†ì´ë„ ì‹ ê³  ê°€ëŠ¥ (ì„¸ì…˜ ê¸°ë°˜)
        setShowReportModal(true);
    };

    const handleReportSubmit = () => {
        onReport?.(reportReason);
        setShowReportModal(false);
    };

    const handlePriceClick = (e: React.MouseEvent) => {
        e.stopPropagation();
        if (!isLoggedIn) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            return;
        }
        setNewPrice(item.lprice.toString());
        setShowPriceModal(true);
    };

    const handlePriceSubmit = () => {
        const price = parseInt(newPrice.replace(/,/g, ''), 10);
        if (isNaN(price) || price <= 0) {
            alert('ìœ íš¨í•œ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        onUpdatePrice?.(price);
        setShowPriceModal(false);
    };

    return (
        <>
            <motion.div
                layout
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -20 }}
                whileHover={{ scale: 1.02, y: -4 }}
                whileTap={{ scale: 0.98 }}
                onClick={handleClick}
                className="
                    relative flex flex-col p-0 bg-white rounded-[32px]
                    cursor-pointer transition-all duration-300
                    hover:-translate-y-2
                    shadow-[0_10px_40px_-10px_rgba(0,0,0,0.08)]
                    hover:shadow-[0_20px_50px_-12px_rgba(0,0,0,0.12)]
                    group h-full
                "
            >
                {/* ì´ë¯¸ì§€ (Top Half Cover) */}
                <div className="w-full h-48 sm:h-56 relative overflow-hidden bg-stone-50 rounded-t-[32px]">
                    {imageUrl ? (
                        <img
                            src={imageUrl}
                            alt={item.title}
                            className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                            loading="lazy"
                            onError={(e) => {
                                (e.target as HTMLImageElement).src = 'https://via.placeholder.com/300x200?text=No+Image';
                            }}
                        />
                    ) : (
                        <div className="w-full h-full flex items-center justify-center text-5xl opacity-30">
                            ğŸ¸
                        </div>
                    )}
                    {/* ì¶œì²˜ ë±ƒì§€ (Overlay) */}
                    <span
                        className={`
                            absolute top-4 left-4 px-3 py-1.5 rounded-full text-xs font-bold tracking-wide shadow-sm
                            backdrop-blur-md bg-white/90 ${sourceStyle.text}
                        `}
                    >
                        {sourceStyle.label}
                    </span>

                    {/* ìˆœìœ„ (Overlay) */}
                    {rank && rank <= 3 && (
                        <div className="absolute top-4 right-4 z-10 drop-shadow-md">
                            <PickIcon rank={rank} />
                        </div>
                    )}
                </div>

                {/* ì •ë³´ (Padding) */}
                <div className="flex-1 flex flex-col p-6">
                    {/* ìƒë‹¨: ì œëª© */}
                    <div className="mb-4">
                        <h3 className="text-lg font-bold text-stone-800 line-clamp-2 leading-snug group-hover:text-matcha-700 transition-colors">
                            {item.title}
                        </h3>
                    </div>

                    {/* í•˜ë‹¨: ê°€ê²© + í• ì¸ìœ¨ */}
                    <div className="flex items-end justify-between mt-2">
                        <div>
                            <div className="flex items-baseline gap-1.5">
                                <p className="text-2xl sm:text-3xl font-black text-stone-900 tracking-tight">
                                    {formatPrice(item.lprice)}<span className="text-sm sm:text-base font-bold text-stone-400 ml-1">ì›</span>
                                </p>
                            </div>

                            {discount > 0 && (
                                <p className="text-xs text-stone-500 mt-0.5">
                                    ì‹ í’ˆ ëŒ€ë¹„ <span className="text-matcha-600 font-bold">{discount}%</span> ì €ë ´
                                </p>
                            )}
                            {/* ì¶œì²˜ & íŒë§¤ì²˜ & ë°°ì†¡ì •ë³´ */}
                            <div className="flex items-center gap-2 mb-1 flex-wrap">
                                <span className={`px-2 py-0.5 rounded text-[11px] font-medium ${sourceStyle.bg} ${sourceStyle.text}`}>
                                    {sourceStyle.label}
                                </span>
                                {/* íŒë§¤ì²˜ (ë„¤ì´ë²„ë§Œ í‘œì‹œ) */}
                                {source === 'naver' && mallName && (
                                    <span className="text-xs text-stone-500 font-medium">
                                        {mallName}
                                    </span>
                                )}
                                {/* ë¬´ë£Œë°°ì†¡ ë°°ì§€ (ë„¤ì´ë²„ ì•„ì´í…œì— ì„ì˜ ì ìš© or ì¡°ê±´ë¶€) */}
                                {source === 'naver' && (
                                    <span className="px-1.5 py-0.5 rounded bg-stone-100 text-stone-500 text-[10px]">
                                        ë¬´ë£Œë°°ì†¡
                                    </span>
                                )}
                            </div>

                            {/* ê°€ê²© disclaimer (ë„¤ì´ë²„ ì•„ì´í…œë§Œ) */}
                            {source === 'naver' && (
                                <p className="text-[10px] text-stone-400 mt-0.5">
                                    * ê°€ê²©ì´ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                                </p>
                            )}
                        </div>

                        {/* ë²„íŠ¼ë“¤ */}
                        <div className="flex items-center gap-2">
                            {/* ì—°ì¥ ë²„íŠ¼ (ë³¸ì¸ ë§¤ë¬¼ë§Œ) */}
                            {isOwner && (
                                <button
                                    onClick={handleExtend}
                                    className="px-3 py-1.5 rounded-full bg-matcha-100 text-matcha-700 text-xs font-semibold hover:bg-matcha-200 transition-colors"
                                >
                                    ì—°ì¥
                                </button>
                            )}

                            {/* ìœ ì € ë§¤ë¬¼: ê°€ê²© ì—…ë°ì´íŠ¸ ë²„íŠ¼ (íŒŒë€ìƒ‰) */}
                            {isUserItem && !isOwner && onUpdatePrice && (
                                <button
                                    onClick={handlePriceClick}
                                    className="w-8 h-8 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center hover:bg-blue-200 transition-colors"
                                    title="ê°€ê²© ì—…ë°ì´íŠ¸"
                                >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                </button>
                            )}

                            {/* ìœ ì € ë§¤ë¬¼: ì‹ ê³  ë²„íŠ¼ (ì£¼í™©ìƒ‰) */}
                            {isUserItem && !isOwner && onReport && (
                                <button
                                    onClick={handleReportClick}
                                    className="w-8 h-8 rounded-full bg-orange-100 text-orange-500 flex items-center justify-center hover:bg-orange-200 transition-colors"
                                    title="ì‹ ê³ í•˜ê¸°"
                                >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                </button>
                            )}

                            {/* í™”ì‚´í‘œ ì•„ì´ì½˜ */}
                            <div className="w-8 h-8 rounded-full bg-stone-50 flex items-center justify-center text-stone-400 group-hover:bg-matcha-50 group-hover:text-matcha-600 transition-colors">
                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M9 5l7 7-7 7" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </motion.div>

            {/* ì‹ ê³  ëª¨ë‹¬ */}
            <AnimatePresence>
                {showReportModal && (
                    <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
                        onClick={() => setShowReportModal(false)}
                    >
                        <motion.div
                            initial={{ scale: 0.9, opacity: 0 }}
                            animate={{ scale: 1, opacity: 1 }}
                            exit={{ scale: 0.9, opacity: 0 }}
                            className="bg-white rounded-2xl p-6 max-w-sm w-full shadow-xl"
                            onClick={(e) => e.stopPropagation()}
                        >
                            <h3 className="text-lg font-bold text-stone-800 mb-4">ğŸš¨ ì‹ ê³ í•˜ê¸°</h3>
                            <div className="space-y-2 mb-4">
                                {(Object.keys(REPORT_REASON_LABELS) as ReportReason[]).map((reason) => (
                                    <label
                                        key={reason}
                                        className={`flex items-center gap-2 p-3 rounded-lg cursor-pointer transition-colors ${reportReason === reason ? 'bg-red-50 border-red-200 border' : 'bg-stone-50 hover:bg-stone-100'
                                            }`}
                                    >
                                        <input
                                            type="radio"
                                            name="report-reason"
                                            value={reason}
                                            checked={reportReason === reason}
                                            onChange={() => setReportReason(reason)}
                                            className="accent-red-500"
                                        />
                                        <span className="text-sm text-stone-700">{REPORT_REASON_LABELS[reason]}</span>
                                    </label>
                                ))}
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setShowReportModal(false)}
                                    className="flex-1 py-2 rounded-lg bg-stone-100 text-stone-600 font-medium hover:bg-stone-200 transition-colors"
                                >
                                    ì·¨ì†Œ
                                </button>
                                <button
                                    onClick={handleReportSubmit}
                                    className="flex-1 py-2 rounded-lg bg-red-500 text-white font-medium hover:bg-red-600 transition-colors"
                                >
                                    ì‹ ê³ 
                                </button>
                            </div>
                        </motion.div>
                    </motion.div>
                )}
            </AnimatePresence>

            {/* ê°€ê²© ì—…ë°ì´íŠ¸ ëª¨ë‹¬ */}
            <AnimatePresence>
                {showPriceModal && (
                    <motion.div
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        exit={{ opacity: 0 }}
                        className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
                        onClick={() => setShowPriceModal(false)}
                    >
                        <motion.div
                            initial={{ scale: 0.9, opacity: 0 }}
                            animate={{ scale: 1, opacity: 1 }}
                            exit={{ scale: 0.9, opacity: 0 }}
                            className="bg-white rounded-2xl p-6 max-w-sm w-full shadow-xl"
                            onClick={(e) => e.stopPropagation()}
                        >
                            <h3 className="text-lg font-bold text-stone-800 mb-4">ğŸ’° ê°€ê²© ì—…ë°ì´íŠ¸</h3>
                            <p className="text-sm text-stone-500 mb-4">
                                ê°€ê²©ì´ ë³€ë™ë˜ì—ˆë‚˜ìš”? ìƒˆ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                            </p>
                            <div className="relative mb-4">
                                <input
                                    type="text"
                                    value={newPrice}
                                    onChange={(e) => setNewPrice(e.target.value.replace(/[^0-9]/g, ''))}
                                    className="w-full px-4 py-3 rounded-lg border border-stone-200 focus:border-matcha-400 focus:ring-2 focus:ring-matcha-100 outline-none text-lg"
                                    placeholder="ê°€ê²© ì…ë ¥"
                                />
                                <span className="absolute right-4 top-1/2 -translate-y-1/2 text-stone-400">ì›</span>
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setShowPriceModal(false)}
                                    className="flex-1 py-2 rounded-lg bg-stone-100 text-stone-600 font-medium hover:bg-stone-200 transition-colors"
                                >
                                    ì·¨ì†Œ
                                </button>
                                <button
                                    onClick={handlePriceSubmit}
                                    className="flex-1 py-2 rounded-lg bg-matcha-500 text-white font-medium hover:bg-matcha-600 transition-colors"
                                >
                                    ì—…ë°ì´íŠ¸
                                </button>
                            </div>
                        </motion.div>
                    </motion.div>
                )}
            </AnimatePresence>
        </>
    );
}
</file>

<file path="src/components/MatchaBounceLoader.tsx">
/**
 * Matcha-Bounce Loader Component
 * 
 * Features:
 * - GIF ì´ë¯¸ì§€ë§Œ í¬ê²Œ í‘œì‹œ
 * - ì™„ë£Œ ì‹œ ìŠ¬ë¼ì´ë“œ ì•„ì›ƒ
 */

import { motion, AnimatePresence } from 'framer-motion';
import daguLoadingGif from '../assets/daguLoading.gif';

interface MatchaBounceLoaderProps {
    isVisible: boolean;
    onComplete?: () => void;
}

export default function MatchaBounceLoader({
    isVisible,
    onComplete
}: MatchaBounceLoaderProps) {
    return (
        <AnimatePresence onExitComplete={onComplete}>
            {isVisible && (
                <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    exit={{
                        opacity: 0,
                        y: -100,
                        transition: { duration: 0.4, ease: 'easeInOut' }
                    }}
                    className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-white"
                >
                    {/* ë©”ì¸ GIF ì´ë¯¸ì§€ */}
                    <img
                        src={daguLoadingGif}
                        alt="ë‹¤êµ¬ ë¡œë”©"
                        className="max-w-md max-h-md"
                    />
                    {/* ë¡œë”© í…ìŠ¤íŠ¸ */}
                    <p className="mt-4 text-lg text-stone-600 font-medium">
                        ë‹¤êµ¬ê°€ ì•…ê¸°ë¥¼ ë‚šëŠ”ì¤‘...
                    </p>
                </motion.div>
            )}
        </AnimatePresence>
    );
}
</file>

<file path="src/components/SearchBar.tsx">
/**
 * Search Bar Component
 * 
 * Features:
 * - ëª¨ë°”ì¼ í¼ìŠ¤íŠ¸ ë””ìì¸
 * - DBì—ì„œ ì•…ê¸° ëª©ë¡ ìë™ì™„ì„±
 * - ê²€ìƒ‰ ë²„íŠ¼ hover íš¨ê³¼
 */

import { useState, useEffect, useRef, type FormEvent } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

interface SearchBarProps {
    onSearch: (query: string) => void;
    isLoading?: boolean;
    placeholder?: string;
    initialValue?: string;
    showSuggestions?: boolean;
}

interface Instrument {
    id: string;
    brand: string;
    name: string;  // APIì—ì„œëŠ” 'name' í•„ë“œ ì‚¬ìš©
    category: string;
}

export default function SearchBar({
    onSearch,
    isLoading = false,
    placeholder = 'ì•…ê¸° ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ (ì˜ˆ: íœë” ìŠ¤íŠ¸ë«)',
    initialValue = '',
    showSuggestions = true,
}: SearchBarProps) {
    const [query, setQuery] = useState(initialValue);
    const [isFocused, setIsFocused] = useState(false);
    const [instruments, setInstruments] = useState<Instrument[]>([]);
    const [suggestions, setSuggestions] = useState<Instrument[]>([]);
    const [showDropdown, setShowDropdown] = useState(false);
    const wrapperRef = useRef<HTMLDivElement>(null);

    // DBì—ì„œ ì•…ê¸° ëª©ë¡ ë¡œë“œ (ìµœì´ˆ 1íšŒ)
    useEffect(() => {
        async function fetchInstruments() {
            try {
                const res = await fetch('/api/instruments/');
                if (res.ok) {
                    const data = await res.json();
                    // DRF í˜ì´ì§€ë„¤ì´ì…˜ ì‘ë‹µ ì²˜ë¦¬ (results ë°°ì—´)
                    const results = data.results || data;
                    setInstruments(Array.isArray(results) ? results : []);
                }
            } catch (error) {
                console.error('ì•…ê¸° ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        fetchInstruments();
    }, []);

    // ì…ë ¥ì— ë”°ë¥¸ ì¶”ì²œ í•„í„°ë§
    useEffect(() => {
        if (query.trim().length > 0 && showSuggestions && instruments.length > 0) {
            const queryLower = query.toLowerCase();
            const filtered = instruments.filter(item => {
                const brand = item.brand || '';
                const modelName = item.name || '';
                const fullName = `${brand} ${modelName}`.toLowerCase();
                return fullName.includes(queryLower) ||
                    brand.toLowerCase().includes(queryLower) ||
                    modelName.toLowerCase().includes(queryLower);
            }).slice(0, 6); // ìµœëŒ€ 6ê°œ
            setSuggestions(filtered);
            setShowDropdown(filtered.length > 0 && isFocused);
        } else {
            setSuggestions([]);
            setShowDropdown(false);
        }
    }, [query, isFocused, showSuggestions, instruments]);

    // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
    useEffect(() => {
        function handleClickOutside(event: MouseEvent) {
            if (wrapperRef.current && !wrapperRef.current.contains(event.target as Node)) {
                setShowDropdown(false);
            }
        }
        document.addEventListener('mousedown', handleClickOutside);
        return () => document.removeEventListener('mousedown', handleClickOutside);
    }, []);

    const handleSubmit = (e: FormEvent) => {
        e.preventDefault();
        if (query.trim()) {
            onSearch(query.trim());
            setShowDropdown(false);
        }
    };

    const handleSuggestionClick = (instrument: Instrument) => {
        const searchTerm = `${instrument.brand} ${instrument.name}`;
        setQuery(searchTerm);
        onSearch(searchTerm);
        setShowDropdown(false);
    };

    // ì¹´í…Œê³ ë¦¬ë³„ ì´ëª¨ì§€
    const getCategoryEmoji = (category: string) => {
        switch (category.toLowerCase()) {
            case 'ì¼ë ‰ê¸°íƒ€': case 'guitar': return 'ğŸ¸';
            case 'ë² ì´ìŠ¤': case 'bass': return 'ğŸ¸';
            case 'ì´í™í„°': case 'pedal': case 'effects': return 'ğŸ”Š';
            case 'ì•°í”„': case 'amp': return 'ğŸ”ˆ';
            case 'ì–´ì¿ ìŠ¤í‹±': case 'acoustic': return 'ğŸª•';
            default: return 'ğŸµ';
        }
    };

    return (
        <motion.form
            onSubmit={handleSubmit}
            className="w-full max-w-2xl mx-auto"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
        >
            <div ref={wrapperRef} className="relative">
                <div
                    className={`
                        relative flex items-center gap-2 p-3 rounded-full transition-all duration-300
                        ${isFocused
                            ? 'bg-white shadow-[0_8px_30px_rgba(0,0,0,0.12)] ring-2 ring-matcha-500 transform -translate-y-1'
                            : 'bg-white shadow-[0_4px_20px_rgba(0,0,0,0.08)] hover:shadow-[0_8px_25px_rgba(0,0,0,0.12)] hover:-translate-y-0.5'
                        }
                    `}
                    style={{ backdropFilter: 'blur(8px)' }}
                >
                    {/* ê²€ìƒ‰ ì•„ì´ì½˜ */}
                    <div className={`pl-4 transition-colors duration-300 ${isFocused ? 'text-matcha-500' : 'text-stone-400'}`}>
                        <svg
                            className="w-5 h-5"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                strokeLinecap="round"
                                strokeLinejoin="round"
                                strokeWidth={2}
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                            />
                        </svg>
                    </div>

                    {/* ì…ë ¥ í•„ë“œ */}
                    <input
                        type="text"
                        value={query}
                        onChange={(e) => setQuery(e.target.value)}
                        onFocus={() => setIsFocused(true)}
                        onBlur={() => setTimeout(() => setIsFocused(false), 150)}
                        placeholder={placeholder}
                        disabled={isLoading}
                        autoComplete="off"
                        className="
                            flex-1 py-3 px-2 bg-transparent outline-none
                            text-stone-800 placeholder-stone-400
                            text-base sm:text-lg caret-matcha-500
                        "
                    />

                    {/* ê²€ìƒ‰ ë²„íŠ¼ */}
                    <motion.button
                        type="submit"
                        disabled={isLoading}
                        whileHover={{ scale: 1.02 }}
                        whileTap={{ scale: 0.98 }}
                        className={`
                            px-8 py-4 rounded-xl font-bold text-lg text-white
                            transition-all duration-200
                            ${isLoading
                                ? 'bg-stone-300 cursor-not-allowed'
                                : 'bg-[#10B981] hover:bg-[#059669] shadow-lg shadow-emerald-500/30 hover:shadow-emerald-500/40 hover:scale-105 active:scale-95'
                            }
                        `}
                    >
                        {isLoading ? (
                            <motion.div
                                className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full"
                                animate={{ rotate: 360 }}
                                transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}
                            />
                        ) : (
                            <span className="whitespace-nowrap">ê²€ìƒ‰</span>
                        )}
                    </motion.button>
                </div>

                {/* ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ (DB ì•…ê¸° ëª©ë¡) */}
                <AnimatePresence>
                    {showDropdown && suggestions.length > 0 && (
                        <motion.div
                            initial={{ opacity: 0, y: -10 }}
                            animate={{ opacity: 1, y: 0 }}
                            exit={{ opacity: 0, y: -10 }}
                            transition={{ duration: 0.15 }}
                            className="
                                absolute z-50 w-full mt-2 py-2
                                bg-white rounded-xl shadow-xl border border-stone-100
                                overflow-hidden
                            "
                        >
                            <p className="px-4 py-1 text-[10px] text-stone-400 uppercase tracking-wider">
                                ë“±ë¡ëœ ì•…ê¸°
                            </p>
                            {suggestions.map((instrument) => (
                                <button
                                    key={instrument.id}
                                    type="button"
                                    onClick={() => handleSuggestionClick(instrument)}
                                    className="
                                        w-full px-4 py-3 text-left flex items-center gap-3
                                        hover:bg-matcha-50 transition-colors
                                        text-stone-700 hover:text-matcha-700
                                    "
                                >
                                    <span className="text-lg">{getCategoryEmoji(instrument.category)}</span>
                                    <div className="flex-1">
                                        <p className="font-medium">{instrument.brand} {instrument.name}</p>
                                        <p className="text-xs text-stone-400">{instrument.category}</p>
                                    </div>
                                </button>
                            ))}
                        </motion.div>
                    )}
                </AnimatePresence>
            </div>

            {/* ê²€ìƒ‰ íŒíŠ¸ */}
            <motion.p
                className="mt-3 text-center text-sm text-stone-500"
                initial={{ opacity: 0 }}
                animate={{ opacity: 0.8 }}
                transition={{ delay: 0.3 }}
            >
                ë¸Œëœë“œ, ëª¨ë¸ëª…, ë˜ëŠ” ì¹´í…Œê³ ë¦¬ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”
            </motion.p>
        </motion.form>
    );
}
</file>

<file path="src/components/VSComparisonLayout.tsx">
/**
 * VS Comparison Layout Component
 * 
 * Features:
 * - ì¢Œ: ì‹ í’ˆ ê¸°ì¤€ê°€ (Gray tone)
 * - ìš°: ì¤‘ê³  ìµœì €ê°€ ë¦¬ìŠ¤íŠ¸ (Accent color)
 * - ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ
 */

import { motion } from 'framer-motion';
import ItemCard from './ItemCard';
import type { NaverItem, MergedUserItem } from '../types';

interface VSComparisonLayoutProps {
    reference: {
        name: string;
        price: number;
        image_url: string;
    } | null;
    items: (NaverItem | MergedUserItem)[];
    onItemClick?: (item: NaverItem | MergedUserItem) => void;
}

function formatPrice(price: number): string {
    return new Intl.NumberFormat('ko-KR').format(price);
}

export default function VSComparisonLayout({
    reference,
    items,
    onItemClick,
}: VSComparisonLayoutProps) {
    // ìƒìœ„ 5ê°œë§Œ í‘œì‹œ
    const topItems = items.slice(0, 5);
    const lowestPrice = topItems[0]?.lprice || 0;
    const savings = reference ? reference.price - lowestPrice : 0;
    const savingsPercent = reference && reference.price > 0
        ? Math.round((savings / reference.price) * 100)
        : 0;

    return (
        <div className="w-full max-w-5xl mx-auto">
            {/* VS í—¤ë” */}
            <motion.div
                className="flex items-center justify-center gap-4 mb-8"
                initial={{ opacity: 0, y: -20 }}
                animate={{ opacity: 1, y: 0 }}
            >
                <span className="text-stone-400 font-medium">ì‹ í’ˆ</span>
                <div className="w-12 h-12 rounded-full bg-gradient-to-r from-stone-300 to-matcha-400 flex items-center justify-center text-white font-bold text-lg shadow-lg">
                    VS
                </div>
                <span className="text-matcha-600 font-medium">ì¤‘ê³ </span>
            </motion.div>

            {/* ë©”ì¸ ì»¨í…ì¸  */}
            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8">
                {/* ì¢Œì¸¡: ì‹ í’ˆ ê¸°ì¤€ê°€ */}
                <motion.div
                    className="lg:col-span-4"
                    initial={{ opacity: 0, x: -30 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: 0.1 }}
                >
                    <div className="sticky top-4 p-6 bg-white/50 backdrop-blur-sm rounded-2xl border border-stone-200 shadow-sm">
                        <h3 className="text-sm font-medium text-stone-500 mb-4 uppercase tracking-wider">
                            Reference Price
                        </h3>

                        {reference ? (
                            <>
                                {/* ì´ë¯¸ì§€ */}
                                {reference.image_url && (
                                    <div className="w-full aspect-square rounded-xl overflow-hidden bg-white mb-6 border border-stone-100 shadow-inner">
                                        <img
                                            src={reference.image_url}
                                            alt={reference.name}
                                            className="w-full h-full object-contain p-4 mix-blend-multiply"
                                        />
                                    </div>
                                )}

                                {/* ì•…ê¸° ì´ë¦„ */}
                                <p className="text-lg font-bold text-stone-800 mb-2 leading-tight">
                                    {reference.name}
                                </p>

                                {/* ê°€ê²© */}
                                <p className="text-2xl font-bold text-stone-400 line-through decoration-2 decoration-stone-300/50">
                                    â‚©{formatPrice(reference.price)}
                                </p>
                                <p className="text-sm text-stone-400 mt-1">ì‹ í’ˆ í‰ê· ê°€</p>

                                {/* ì ˆì•½ ê¸ˆì•¡ */}
                                {savings > 0 && (
                                    <motion.div
                                        className="mt-6 p-4 bg-matcha-50 rounded-xl border border-matcha-100 relative overflow-hidden"
                                        initial={{ opacity: 0, scale: 0.9 }}
                                        animate={{ opacity: 1, scale: 1 }}
                                        transition={{ delay: 0.3 }}
                                    >
                                        <div className="absolute top-0 right-0 -mr-4 -mt-4 w-12 h-12 bg-matcha-200 rounded-full blur-xl opacity-50"></div>

                                        <p className="text-sm font-medium text-matcha-800 mb-1">
                                            ì¤‘ê³ ë¡œ êµ¬ë§¤ ì‹œ
                                        </p>
                                        <div className="flex items-baseline gap-2">
                                            <p className="text-2xl font-bold text-matcha-600">
                                                {savingsPercent}%
                                            </p>
                                            <span className="text-matcha-600 font-medium">Save</span>
                                        </div>
                                        <p className="text-sm text-matcha-600 mt-0.5 opacity-80">
                                            ì•½ â‚©{formatPrice(savings)} ì ˆì•½
                                        </p>
                                    </motion.div>
                                )}
                            </>
                        ) : (
                            <div className="text-center py-8 text-stone-400">
                                <p className="text-4xl mb-2 opacity-50">ğŸ“Š</p>
                                <p>ê¸°ì¤€ê°€ ì •ë³´ ì—†ìŒ</p>
                            </div>
                        )}
                    </div>
                </motion.div>

                {/* ìš°ì¸¡: ì¤‘ê³  ìµœì €ê°€ ë¦¬ìŠ¤íŠ¸ */}
                <motion.div
                    className="lg:col-span-8"
                    initial={{ opacity: 0, x: 30 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: 0.2 }}
                >
                    <div className="flex items-center justify-between mb-4 px-1">
                        <h3 className="text-lg font-bold text-stone-800 flex items-center gap-2">
                            <span className="text-2xl">ğŸ”¥</span> ìµœì €ê°€ TOP {Math.min(topItems.length, 5)}
                        </h3>
                        <span className="text-xs font-medium px-2 py-1 bg-stone-100 rounded-full text-stone-500">
                            ì´ {items.length}ê°œ ë§¤ë¬¼
                        </span>
                    </div>

                    {topItems.length > 0 ? (
                        <div className="space-y-4">
                            {topItems.map((item, index) => (
                                <ItemCard
                                    key={`item-${index}-${'id' in item ? item.id : item.productId}`}
                                    item={item}
                                    rank={index + 1}
                                    referencePrice={reference?.price}
                                    onClick={() => onItemClick?.(item)}
                                />
                            ))}
                        </div>
                    ) : (
                        <div className="text-center py-16 bg-white/50 border border-dashed border-stone-300 rounded-2xl">
                            <p className="text-4xl mb-4 opacity-50">ğŸ¸</p>
                            <p className="text-stone-500 font-medium">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                            <p className="text-sm text-stone-400 mt-1">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”</p>
                        </div>
                    )}

                    {/* ë”ë³´ê¸° (5ê°œ ì´ìƒì¼ ë•Œ) */}
                    {items.length > 5 && (
                        <motion.button
                            className="w-full mt-6 py-4 text-matcha-700 font-bold bg-white border border-matcha-200 rounded-xl hover:bg-matcha-50 hover:border-matcha-300 transition-all shadow-sm"
                            whileHover={{ scale: 1.01, y: -1 }}
                            whileTap={{ scale: 0.99 }}
                        >
                            + {items.length - 5}ê°œ ë”ë³´ê¸°
                        </motion.button>
                    )}
                </motion.div>
            </div>
        </div>
    );
}
</file>

<file path="src/hooks/useAuth.ts">
/**
 * SSO ì¸ì¦ ìƒíƒœ í™•ì¸ Hook.
 * Dagu ë°±ì—”ë“œ APIë¥¼ í†µí•´ HttpOnly ì¿ í‚¤ ì¸ì¦ ìƒíƒœ í™•ì¸.
 */

import { useState, useEffect } from 'react';

interface AuthState {
    isLoggedIn: boolean;
    isLoading: boolean;
    userId: number | null;
    username: string | null;
}

/**
 * ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ Hook
 * HttpOnly ì¿ í‚¤ëŠ” JSì—ì„œ ì½ì„ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ë°±ì—”ë“œ APIë¡œ í™•ì¸
 */
export function useAuth(): AuthState {
    const [state, setState] = useState<AuthState>({
        isLoggedIn: false,
        isLoading: true,
        userId: null,
        username: null,
    });

    useEffect(() => {
        const checkAuth = async () => {
            try {
                const response = await fetch('/api/auth/check/', {
                    credentials: 'include', // ì¿ í‚¤ í¬í•¨ (vite í”„ë¡ì‹œ ê²½ìœ )
                });

                if (response.ok) {
                    const data = await response.json();
                    setState({
                        isLoggedIn: data.is_authenticated,
                        isLoading: false,
                        userId: data.user_id || null,
                        username: data.username || null,
                    });
                } else {
                    setState({
                        isLoggedIn: false,
                        isLoading: false,
                        userId: null,
                        username: null,
                    });
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                setState({
                    isLoggedIn: false,
                    isLoading: false,
                    userId: null,
                    username: null,
                });
            }
        };

        checkAuth();
    }, []);

    return state;
}

export default useAuth;
</file>

<file path="src/hooks/useSearch.ts">
/**
 * React Query hooks for MALCHA-DAGU
 */

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import * as api from '../services/api';
import type { SearchResult } from '../types';

// =============================================================================
// Search Hook
// =============================================================================

export function useSearch(query: string, options?: { enabled?: boolean }) {
    return useQuery<SearchResult>({
        queryKey: ['search', query],
        queryFn: () => api.search(query),
        enabled: options?.enabled ?? query.length > 0,
        staleTime: 5 * 60 * 1000, // 5ë¶„ê°„ ìºì‹œ ìœ ì§€
        gcTime: 10 * 60 * 1000, // 10ë¶„ê°„ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ë°©ì§€
    });
}

// =============================================================================
// Instruments Hook
// =============================================================================

export function useInstruments(params?: {
    brand?: string;
    category?: string;
    search?: string;
}) {
    return useQuery({
        queryKey: ['instruments', params],
        queryFn: () => api.getInstruments(params),
    });
}

export function useInstrument(id: string) {
    return useQuery({
        queryKey: ['instrument', id],
        queryFn: () => api.getInstrument(id),
        enabled: !!id,
    });
}

// =============================================================================
// User Items Hook
// =============================================================================

export function useUserItems(params?: {
    instrument?: string;
    source?: string;
    min_price?: number;
    max_price?: number;
}) {
    return useQuery({
        queryKey: ['userItems', params],
        queryFn: () => api.getUserItems(params),
    });
}

export function useCreateUserItem() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: api.createUserItem,
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: ['userItems'] });
            queryClient.invalidateQueries({ queryKey: ['search'] });
        },
    });
}

export function useTrackItemClick() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: api.trackItemClick,
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: ['userItems'] });
        },
    });
}

export function useExtendUserItem() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: api.extendUserItem,
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: ['search'] });
            queryClient.invalidateQueries({ queryKey: ['userItems'] });
        },
    });
}

export function useReportItem() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: ({ id, reason, detail }: { id: string; reason: string; detail?: string }) =>
            api.reportUserItem(id, { reason, detail }),
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: ['search'] });
            queryClient.invalidateQueries({ queryKey: ['userItems'] });
        },
    });
}

export function useUpdateItemPrice() {
    const queryClient = useQueryClient();

    return useMutation({
        mutationFn: ({ id, price }: { id: string; price: number }) =>
            api.updateItemPrice(id, price),
        onSuccess: () => {
            queryClient.invalidateQueries({ queryKey: ['search'] });
            queryClient.invalidateQueries({ queryKey: ['userItems'] });
        },
    });
}

// =============================================================================
// AI Description Hook
// =============================================================================

export function useAIDescription() {
    return useMutation({
        mutationFn: api.getAIDescription,
    });
}
</file>

<file path="src/index.css">
@import "tailwindcss";

@theme {
  /* Matcha Green Palette */
  --color-matcha-50: #f0fdf4;
  --color-matcha-100: #dcfce7;
  --color-matcha-200: #bbf7d0;
  --color-matcha-300: #86efac;
  --color-matcha-400: #4ade80;
  --color-matcha-500: #22c55e;
  --color-matcha-600: #16a34a;
  --color-matcha-700: #15803d;
  --color-matcha-800: #166534;
  --color-matcha-900: #14532d;

  /* Cream/Warm Palette */
  --color-cream-50: #fffbeb;
  --color-cream-100: #fef3c7;
  --color-cream-200: #fde68a;
  --color-cream-300: #fcd34d;

  /* Fonts */
  --font-display: 'Outfit', sans-serif;
  --font-body: 'Inter', sans-serif;
}

/* =============================================================================
   Base Layer
   ============================================================================= */
@layer base {
  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: var(--font-body);
    background: linear-gradient(135deg, #FDFBF7 0%, #F9F8F4 100%);
    min-height: 100vh;
    color: var(--color-stone-800);
    @apply antialiased;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-display);
    @apply font-semibold leading-tight;
  }
}

/* =============================================================================
   Utilities Layer
   ============================================================================= */
@layer utilities {
  .text-gradient {
    background: linear-gradient(135deg, var(--color-matcha-600) 0%, var(--color-matcha-400) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .glass {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .glass-dark {
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Scrollbar */
  .scrollbar-custom::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .scrollbar-custom::-webkit-scrollbar-track {
    @apply bg-stone-100;
  }

  .scrollbar-custom::-webkit-scrollbar-thumb {
    @apply bg-matcha-400 rounded-full;
  }

  .scrollbar-custom::-webkit-scrollbar-thumb:hover {
    @apply bg-matcha-500;
  }
}

/* =============================================================================
   Components Layer (Animations)
   ============================================================================= */
@layer components {

  /* Using standard tailwind animation utilities where possible, extending custom ones */
  @keyframes bounce-soft {

    0%,
    100% {
      transform: translateY(0);
    }

    50% {
      transform: translateY(-12px);
    }
  }

  @keyframes pulse-glow {

    0%,
    100% {
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
    }

    50% {
      box-shadow: 0 0 40px rgba(34, 197, 94, 0.5);
    }
  }

  @keyframes slide-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-bounce-soft {
    animation: bounce-soft 2s ease-in-out infinite;
  }

  .animate-pulse-glow {
    animation: pulse-glow 2s ease-in-out infinite;
  }

  .animate-slide-up {
    animation: slide-up 0.5s ease-out forwards;
  }
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="src/pages/HomePage.tsx">
/**
 * Home Page Component
 *
 * Features:
 * - íˆì–´ë¡œ ì„¹ì…˜
 * - ê²€ìƒ‰ë°”
 * - ì‹¤ì‹œê°„ ì¸ê¸° ê²€ìƒ‰ì–´
 * - ê²€ìƒ‰ ì‹œ ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
 */

import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import SearchBar from '../components/SearchBar';
import { getPopularSearches } from '../services/api';

const DEFAULT_TERMS = ['íœë” ìŠ¤íŠ¸ë«', 'ê¹ìŠ¨ ë ˆìŠ¤í´', 'í…Œì¼ëŸ¬ ì–´ì¿ ìŠ¤í‹±', 'SM58'];

export default function HomePage() {
    const navigate = useNavigate();
    const [popularTerms, setPopularTerms] = useState<string[]>(DEFAULT_TERMS);

    // ì¸ê¸° ê²€ìƒ‰ì–´ ë¡œë“œ
    useEffect(() => {
        async function fetchPopularSearches() {
            try {
                const terms = await getPopularSearches(4);
                if (terms && terms.length > 0) {
                    setPopularTerms(terms);
                }
            } catch (error) {
                console.warn('Failed to fetch popular searches:', error);
                // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ ìœ ì§€
            }
        }
        fetchPopularSearches();
    }, []);

    const handleSearch = (query: string) => {
        navigate(`/search?q=${encodeURIComponent(query)}`);
    };

    return (
        <div className="min-h-screen flex flex-col">
            {/* íˆì–´ë¡œ ì„¹ì…˜ */}
            <main className="flex-1 flex flex-col items-center justify-center px-4 py-16">
                {/* ë¡œê³  / íƒ€ì´í‹€ */}
                <motion.div
                    className="text-center mb-12"
                    initial={{ opacity: 0, y: -30 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.6 }}
                >
                    <motion.div
                        className="text-8xl sm:text-9xl mb-6"
                        animate={{
                            y: [0, -10, 0],
                            rotate: [0, -5, 5, 0],
                        }}
                        transition={{
                            duration: 3,
                            repeat: Infinity,
                            ease: 'easeInOut',
                        }}
                    >
                        ğŸµ
                    </motion.div>

                    <h1 className="text-7xl sm:text-8xl font-black mb-8 tracking-tighter text-stone-800">
                        DAGU
                    </h1>

                    <p className="text-2xl sm:text-3xl text-stone-600 max-w-2xl mx-auto leading-relaxed">
                        ì•…ê¸° ì‹œì„¸ë¥¼ í•œëˆˆì— ë¹„êµí•˜ê³ , <br className="sm:hidden" />
                        <span className="bg-matcha-200 text-matcha-900 px-2 py-0.5 mx-1 font-bold rounded-sm inline-block transform -rotate-1">í•©ë¦¬ì ì¸ ê°€ê²©</span>ì— ë“í…œí•˜ì„¸ìš”
                    </p>
                </motion.div>

                {/* ê²€ìƒ‰ë°” */}
                <div className="w-full max-w-xl px-4 relative z-10">
                    <SearchBar onSearch={handleSearch} />
                </div>

                {/* ì¸ê¸° ê²€ìƒ‰ì–´ / ë¹ ë¥¸ ê²€ìƒ‰ */}
                <motion.div
                    className="mt-12 flex flex-col items-center gap-4"
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ delay: 0.5 }}
                >
                    <span className="text-sm font-medium text-stone-400 uppercase tracking-widest text-[11px] mb-2">ì¸ê¸° ê²€ìƒ‰ì–´</span>
                    <div className="flex flex-wrap justify-center gap-2.5">
                        {popularTerms.map((term) => (
                            <motion.button
                                key={term}
                                onClick={() => handleSearch(term)}
                                className="
                                    px-5 py-2.5 text-base bg-white text-stone-600
                                    rounded-full shadow-sm shadow-stone-200
                                    hover:bg-matcha-50 hover:text-matcha-800 hover:shadow-md hover:-translate-y-0.5
                                    transition-all duration-300
                                    flex items-center gap-2
                                "
                                whileHover={{ scale: 1.05, y: -2 }}
                                whileTap={{ scale: 0.95 }}
                            >
                                <span className="opacity-40 text-xs">#</span>
                                {term}
                            </motion.button>
                        ))}
                    </div>
                </motion.div>
            </main>

            {/* í‘¸í„° */}
            <footer className="py-8 text-center text-sm text-stone-400 mt-auto">
                <p>Â© 2026 MALCHA DAGU. ì•…ê¸° ì‹œì„¸ ë¹„êµ ì„œë¹„ìŠ¤</p>
            </footer>
        </div>
    );
}
</file>

<file path="src/pages/SearchResultPage.tsx">
/**
 * Search Result Page Component
 * 
 * Features:
 * - ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ (Staggered Animation)
 * - ë§¤ë¬¼ ë“±ë¡ ë²„íŠ¼ (API ì—°ë™ + ìë™ ì†ŒìŠ¤ ê°ì§€)
 * - React Query ìºì‹± ë° ìë™ ê°±ì‹ 
 */

import { useState, useEffect } from 'react';
import { useSearchParams, useNavigate } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import { useQueryClient } from '@tanstack/react-query';
import { AxiosError } from 'axios';
import SearchBar from '../components/SearchBar';
import MatchaBounceLoader from '../components/MatchaBounceLoader';
import ItemCard from '../components/ItemCard';
import { useSearch, useTrackItemClick, useCreateUserItem, useExtendUserItem, useReportItem, useUpdateItemPrice } from '../hooks/useSearch';
import { useAuth } from '../hooks/useAuth';
import type { NaverItem, MergedUserItem, ReportReason } from '../types';

// API ì—ëŸ¬ ì‘ë‹µ íƒ€ì…
interface ApiErrorResponse {
    [key: string]: string | string[];
}

// ì†ŒìŠ¤ ìë™ ê°ì§€ í—¬í¼
const SOURCE_LABELS: Record<string, string> = {
    mule: 'ë®¬ (Mule)',
    joonggonara: 'ì¤‘ê³ ë‚˜ë¼',
    danggn: 'ë‹¹ê·¼ë§ˆì¼“',
    bunjang: 'ë²ˆê°œì¥í„°',
    other: 'ê¸°íƒ€ ì‚¬ì´íŠ¸'
};

const SOURCE_COLORS: Record<string, string> = {
    mule: 'bg-blue-50 text-blue-700 border-blue-200',
    joonggonara: 'bg-green-50 text-green-700 border-green-200',
    danggn: 'bg-orange-50 text-orange-700 border-orange-200',
    bunjang: 'bg-red-50 text-red-700 border-red-200',
    other: 'bg-stone-50 text-stone-600 border-stone-200'
};

function detectSource(url: string): string {
    const lower = url.toLowerCase();
    if (lower.includes('mule.co.kr')) return 'mule';
    if (lower.includes('joonggonara') || (lower.includes('cafe.naver.com') && lower.includes('joon'))) return 'joonggonara';
    if (lower.includes('daangn.com') || lower.includes('danggn')) return 'danggn';
    if (lower.includes('bunjang.co.kr')) return 'bunjang';
    return 'other';
}

const MIN_LOADING_TIME = 3400;

export default function SearchResultPage() {
    const [searchParams, setSearchParams] = useSearchParams();
    const navigate = useNavigate();
    const query = searchParams.get('q') || '';

    const [showLoader, setShowLoader] = useState(true);
    const [minTimeElapsed, setMinTimeElapsed] = useState(false);
    const [showRegisterModal, setShowRegisterModal] = useState(false);

    // SSO ì¸ì¦ ìƒíƒœ í™•ì¸
    const { isLoggedIn } = useAuth();

    // React Queryë¡œ ê²€ìƒ‰
    const { data, isLoading, isError, error } = useSearch(query, {
        enabled: query.length > 0,
    });

    // í´ë¦­ ì¶”ì 
    const trackClick = useTrackItemClick();

    // ì—°ì¥ ê¸°ëŠ¥
    const extendItem = useExtendUserItem();

    // ì‹ ê³  ê¸°ëŠ¥
    const reportItem = useReportItem();

    // ê°€ê²© ì—…ë°ì´íŠ¸ ê¸°ëŠ¥
    const updatePrice = useUpdateItemPrice();

    // ìµœì†Œ ë¡œë”© ì‹œê°„ ë³´ì¥
    useEffect(() => {
        if (!query) return;
        setShowLoader(true);
        setMinTimeElapsed(false);
        const timer = setTimeout(() => setMinTimeElapsed(true), MIN_LOADING_TIME);
        return () => clearTimeout(timer);
    }, [query]);

    useEffect(() => {
        if (!isLoading && minTimeElapsed) {
            setShowLoader(false);
        }
    }, [isLoading, minTimeElapsed]);

    // URLì„ ì •ê·œí™”ëœ ê²€ìƒ‰ì–´ë¡œ ì—…ë°ì´íŠ¸ (íœë” ìŠ¤íŠ¸ë« â†’ fender Stratocaster)
    // ë¡œë”© ì™„ë£Œ í›„ì—ë§Œ ì—…ë°ì´íŠ¸ (ë¶ˆí•„ìš”í•œ ì¬ê²€ìƒ‰ ë°©ì§€)
    useEffect(() => {
        if (!showLoader && data?.search_query && data.search_query.toLowerCase() !== query.toLowerCase()) {
            setSearchParams({ q: data.search_query }, { replace: true });
        }
    }, [showLoader, data?.search_query, query, setSearchParams]);

    const handleSearch = (newQuery: string) => {
        navigate(`/search?q=${encodeURIComponent(newQuery)}`);
    };

    const handleItemClick = (item: NaverItem | MergedUserItem) => {
        if ('id' in item && item.source !== 'naver') {
            trackClick.mutate(item.id);
        }
    };

    const handleExtendItem = (itemId: string) => {
        extendItem.mutate(itemId, {
            onSuccess: () => {
                alert('ë§¤ë¬¼ì´ 72ì‹œê°„ ì—°ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            },
            onError: (err: unknown) => {
                const axiosErr = err as AxiosError<{ error?: string }>;
                const statusCode = axiosErr.response?.status;
                const serverMsg = axiosErr.response?.data?.error;

                if (statusCode === 401) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\nì—°ì¥ì€ ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.');
                } else if (statusCode === 403) {
                    alert('ë³¸ì¸ ë§¤ë¬¼ë§Œ ì—°ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                } else if (statusCode === 404) {
                    alert('ë§¤ë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì´ë¯¸ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë§¤ë¬¼ì…ë‹ˆë‹¤.');
                } else if (statusCode === 500) {
                    alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } else if (!axiosErr.response) {
                    alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                } else {
                    alert(serverMsg || 'ì—°ì¥ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            },
        });
    };

    const handleReportItem = (itemId: string, reason: ReportReason) => {
        reportItem.mutate({ id: itemId, reason }, {
            onSuccess: (data) => {
                if (data.is_deleted) {
                    alert('ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\nê°€ê²© ì˜¤ë¥˜ ì‹ ê³ ê°€ ëˆ„ì ë˜ì–´ í•´ë‹¹ ë§¤ë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else if (data.is_under_review) {
                    alert('ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\ní•´ë‹¹ ë§¤ë¬¼ì€ ê²€í†  ëŒ€ê¸° ì¤‘ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤!');
                }
            },
            onError: (err: unknown) => {
                const axiosErr = err as AxiosError<{ error?: string }>;
                const statusCode = axiosErr.response?.status;
                const serverMsg = axiosErr.response?.data?.error;

                // ìƒíƒœ ì½”ë“œë³„ ìƒì„¸ ë©”ì‹œì§€
                if (statusCode === 400) {
                    if (serverMsg?.includes('ì´ë¯¸ ì‹ ê³ ')) {
                        alert('ì´ë¯¸ ì‹ ê³ í•œ ë§¤ë¬¼ì…ë‹ˆë‹¤.\nê°™ì€ ë§¤ë¬¼ì€ í•œ ë²ˆë§Œ ì‹ ê³ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    } else if (serverMsg?.includes('ë³¸ì¸ ë§¤ë¬¼')) {
                        alert('ë³¸ì¸ ë§¤ë¬¼ì€ ì‹ ê³ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    } else {
                        alert(serverMsg || 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.');
                    }
                } else if (statusCode === 404) {
                    alert('ë§¤ë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì´ë¯¸ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë§¤ë¬¼ì…ë‹ˆë‹¤.');
                } else if (statusCode === 500) {
                    alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } else if (!axiosErr.response) {
                    alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                } else {
                    alert(serverMsg || 'ì‹ ê³  ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            },
        });
    };

    const handleUpdatePrice = (itemId: string, newPrice: number) => {
        updatePrice.mutate({ id: itemId, price: newPrice }, {
            onSuccess: () => {
                alert('ê°€ê²©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.\nê°ì‚¬í•©ë‹ˆë‹¤!');
            },
            onError: (err: unknown) => {
                const axiosErr = err as AxiosError<{ error?: string }>;
                const statusCode = axiosErr.response?.status;
                const serverMsg = axiosErr.response?.data?.error;

                // ìƒíƒœ ì½”ë“œë³„ ìƒì„¸ ë©”ì‹œì§€
                if (statusCode === 400) {
                    if (serverMsg?.includes('ìœ íš¨í•œ ê°€ê²©')) {
                        alert('ìœ íš¨í•œ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n0ë³´ë‹¤ í° ìˆ«ìë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                    } else if (serverMsg?.includes('ë„ˆë¬´ ë†’')) {
                        alert('ê°€ê²©ì´ ë„ˆë¬´ ë†’ìŠµë‹ˆë‹¤.\n1ì–µì› ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    } else {
                        alert(serverMsg || 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.');
                    }
                } else if (statusCode === 401) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\nê°€ê²© ì—…ë°ì´íŠ¸ëŠ” ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.');
                } else if (statusCode === 404) {
                    alert('ë§¤ë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì´ë¯¸ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë§¤ë¬¼ì…ë‹ˆë‹¤.');
                } else if (statusCode === 500) {
                    alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } else if (!axiosErr.response) {
                    alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                } else {
                    alert(serverMsg || 'ê°€ê²© ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            },
        });
    };

    // ì†Œìœ ì ì—¬ë¶€ í™•ì¸ (is_owner í•„ë“œê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ false)
    const isItemOwner = (item: NaverItem | MergedUserItem): boolean => {
        if (!isLoggedIn) return false;
        // UserItemSerializerì—ì„œ is_owner í•„ë“œ ì œê³µ ì‹œ ì‚¬ìš©
        if ('is_owner' in item) return (item as { is_owner: boolean }).is_owner;
        return false;
    };

    if (!query) {
        navigate('/');
        return null;
    }

    const allItems = data?.items || [];

    return (
        <div className="min-h-screen">
            <MatchaBounceLoader isVisible={showLoader} />

            {!showLoader && (
                <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ duration: 0.4 }}
                >
                    {/* í—¤ë” */}
                    <header className="sticky top-0 z-40 bg-white/90 backdrop-blur-md border-b border-stone-200 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center gap-4">
                                <motion.button
                                    onClick={() => navigate('/')}
                                    className="text-2xl font-black text-matcha-600 tracking-tight"
                                    whileHover={{ scale: 1.05 }}
                                    whileTap={{ scale: 0.95 }}
                                >
                                    DAGU
                                </motion.button>
                                <div className="flex-1 max-w-2xl">
                                    <SearchBar
                                        onSearch={handleSearch}
                                        isLoading={isLoading}
                                        initialValue={query}
                                        placeholder="ë‹¤ë¥¸ ì•…ê¸° ê²€ìƒ‰"
                                    />
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* ë©”ì¸ Container (Grid Layout) */}
                    <main className="max-w-7xl mx-auto px-4 py-8 grid lg:grid-cols-[1fr_280px] gap-8 items-start">

                        {/* Left Column: Results */}
                        <div className="min-w-0">
                            {/* Title & Count */}
                            <div className="mb-6">
                                <h1 className="text-3xl font-bold text-stone-800 tracking-tight">
                                    "<span className="text-matcha-600">{query}</span>" ê²€ìƒ‰ ê²°ê³¼
                                </h1>
                                {data && (
                                    <p className="text-stone-500 mt-2 font-medium">
                                        ì´ {data.total_count}ê°œì˜ ë§¤ë¬¼ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤
                                    </p>
                                )}
                            </div>

                            {/* Mobile External Search Buttons (Visible only on < lg) */}
                            {/* ì™¸ë¶€ ê²€ìƒ‰ì€ ì •ê·œí™”ëœ ê²€ìƒ‰ì–´ ì‚¬ìš© (search_query: fender Stratocaster ë“±) */}
                            <div className="lg:hidden mb-8">
                                <ExternalSearchButtons query={data?.search_query || query} vertical={false} />
                            </div>

                            {/* ì—ëŸ¬ */}
                            {isError && (
                                <div className="text-center py-12 bg-red-50 rounded-2xl border border-red-100 mb-8">
                                    <p className="text-4xl mb-4">ğŸ˜µ</p>
                                    <p className="text-red-700 font-medium">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
                                    <p className="text-red-500 text-sm mt-2">
                                        {error instanceof Error ? error.message : 'ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”'}
                                    </p>
                                </div>
                            )}

                            {/* ê²°ê³¼ ì—†ìŒ */}
                            {data && data.total_count === 0 && (
                                <div className="text-center py-16 bg-stone-50 rounded-2xl border border-dashed border-stone-300 mb-8">
                                    <p className="text-4xl mb-4 opacity-50">ğŸ¸</p>
                                    <p className="text-stone-600 font-medium">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                                    <p className="text-stone-400 text-sm mt-2">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”</p>
                                </div>
                            )}

                            {/* ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ */}
                            {allItems.length > 0 && (
                                <motion.div
                                    className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
                                    variants={{
                                        hidden: { opacity: 0 },
                                        show: {
                                            opacity: 1,
                                            transition: {
                                                staggerChildren: 0.1
                                            }
                                        }
                                    }}
                                    initial="hidden"
                                    animate="show"
                                >
                                    {allItems.map((item, index) => (
                                        <motion.div
                                            key={`item-${index}-${'id' in item ? item.id : item.productId}`}
                                            variants={{
                                                hidden: { opacity: 0, y: 20 },
                                                show: { opacity: 1, y: 0 }
                                            }}
                                        >
                                            <ItemCard
                                                item={item}
                                                rank={index + 1}
                                                referencePrice={data?.reference?.price}
                                                onClick={() => handleItemClick(item)}
                                                isOwner={isItemOwner(item)}
                                                isLoggedIn={isLoggedIn}
                                                onExtend={'id' in item ? () => handleExtendItem(item.id) : undefined}
                                                onReport={'id' in item && item.source !== 'naver' ? (reason) => handleReportItem(item.id, reason) : undefined}
                                                onUpdatePrice={'id' in item && item.source !== 'naver' ? (price) => handleUpdatePrice(item.id, price) : undefined}
                                            />
                                        </motion.div>
                                    ))}
                                </motion.div>
                            )}
                        </div>

                        {/* Right Column: Sticky Sidebar (Visible only on >= lg) */}
                        <aside className="hidden lg:block h-full">
                            <div className="sticky top-24 space-y-4">
                                <div className="p-4 bg-stone-50 rounded-2xl border border-stone-100">
                                    <h3 className="text-sm font-bold text-stone-500 mb-3 uppercase tracking-wider">ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œ ì°¾ê¸°</h3>
                                    <ExternalSearchButtons query={data?.search_query || query} vertical={true} />
                                </div>
                                {/* ì¶”í›„ ë‹¤ë¥¸ ì‚¬ì´ë“œë°” ì»¨í…ì¸  ì¶”ê°€ ê°€ëŠ¥ (ì˜ˆ: ê´‘ê³ , ì¶”ì²œ ê²€ìƒ‰ì–´ ë“±) */}
                            </div>
                        </aside>

                    </main>

                    {/* FAB (ë§¤ë¬¼ ë“±ë¡) - ë¡œê·¸ì¸ ì‹œì—ë§Œ í‘œì‹œ */}
                    {isLoggedIn && (
                        <motion.button
                            onClick={() => setShowRegisterModal(true)}
                            className="
                                fixed bottom-8 right-8 z-50
                                w-14 h-14 rounded-full
                                bg-matcha-500 text-white
                                shadow-[0_4px_0_0_#16a34a]
                                flex items-center justify-center
                                hover:bg-matcha-600 active:shadow-[0_2px_0_0_#16a34a] active:translate-y-[2px]
                                transition-all duration-150
                            "
                            initial={{ scale: 0, rotate: 90 }}
                            animate={{ scale: 1, rotate: 0 }}
                            whileHover={{ scale: 1.05 }}
                            whileTap={{ scale: 0.95 }}
                        >
                            <svg className="w-7 h-7" fill="none" stroke="currentColor" strokeWidth={2.5} viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                            </svg>
                        </motion.button>
                    )}
                </motion.div>
            )}

            {/* ë§¤ë¬¼ ë“±ë¡ ëª¨ë‹¬ */}
            <AnimatePresence>
                {showRegisterModal && (
                    <RegisterModal
                        query={query}
                        onClose={() => setShowRegisterModal(false)}
                    />
                )}
            </AnimatePresence>
        </div>
    );
}

// ì™¸ë¶€ ê²€ìƒ‰ ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸
const ExternalSearchButtons = ({ query, vertical }: { query: string, vertical: boolean }) => (
    <div className={`flex ${vertical ? 'flex-col gap-3' : 'flex-wrap gap-2'}`}>
        {/* Mule */}
        <a
            href={`https://www.mule.co.kr/bbs/market/sell?page=1&map=list&mode=list&region=&start_price=&end_price=&qf=title&qs=${encodeURIComponent(query)}&category=&ct1=&ct2=&ct3=&store=&options=&soldout=&sell_status=&sido=&gugun=&dong=&period=&of=wdate&od=desc&andor=and&v=l`}
            target="_blank"
            rel="noopener noreferrer"
            className={`
                flex items-center ${vertical ? 'justify-between px-5 py-4' : 'justify-center gap-2 px-6 py-3'} 
                rounded-xl bg-blue-100 text-blue-700
                hover:bg-blue-200 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-blue-200/50
                transition-all duration-200 group
            `}
        >
            <span className={`font-bold ${vertical ? 'text-base' : ''}`}>Mule</span>
            <svg className="w-4 h-4 opacity-70 group-hover:translate-x-0.5 group-hover:opacity-100 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
        </a>

        {/* Reverb */}
        <a
            href={`https://reverb.com/marketplace?query=${encodeURIComponent(query)}`}
            target="_blank"
            rel="noopener noreferrer"
            className={`
                flex items-center ${vertical ? 'justify-between px-5 py-4' : 'justify-center gap-2 px-6 py-3'} 
                rounded-xl bg-yellow-100 text-yellow-700
                hover:bg-yellow-200 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-yellow-200/50
                transition-all duration-200 group
            `}
        >
            <span className={`font-bold ${vertical ? 'text-base' : ''}`}>Reverb</span>
            <svg className="w-4 h-4 opacity-70 group-hover:translate-x-0.5 group-hover:opacity-100 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
        </a>

        {/* Digimart */}
        <a
            href={`https://www.digimart.net/search?productKeyword=${encodeURIComponent(query)}`}
            target="_blank"
            rel="noopener noreferrer"
            className={`
                flex items-center ${vertical ? 'justify-between px-5 py-4' : 'justify-center gap-2 px-6 py-3'} 
                rounded-xl bg-red-100 text-red-700
                hover:bg-red-200 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-red-200/50
                transition-all duration-200 group
            `}
        >
            <span className={`font-bold ${vertical ? 'text-base' : ''}`}>Digimart</span>
            <svg className="w-4 h-4 opacity-70 group-hover:translate-x-0.5 group-hover:opacity-100 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
        </a>
    </div>
);

// ë§¤ë¬¼ ë“±ë¡ ëª¨ë‹¬
function RegisterModal({ query, onClose }: { query: string; onClose: () => void }) {
    const [price, setPrice] = useState('');
    const [link, setLink] = useState('');
    const [detectedSource, setDetectedSource] = useState('other');

    // ë§í¬ ì…ë ¥ ì‹œ ì†ŒìŠ¤ ê°ì§€
    useEffect(() => {
        setDetectedSource(detectSource(link));
    }, [link]);

    // API Hook
    const createUserItem = useCreateUserItem();
    const queryClient = useQueryClient();

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();

        // 1. ë§í¬ URL ë³´ì • (http/https ì—†ìœ¼ë©´ ì¶”ê°€)
        let finalLink = link.trim();
        if (finalLink && !finalLink.match(/^https?:\/\//)) {
            finalLink = `https://${finalLink}`;
        }

        // 2. ìµœì¢… ì†ŒìŠ¤ ê²°ì •
        const finalSource = detectSource(finalLink);

        createUserItem.mutate({
            title: query,
            price: Number(price),
            link: finalLink,
            source: finalSource
        }, {
            onSuccess: () => {
                // ê²€ìƒ‰ ê²°ê³¼ ì¦‰ì‹œ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°
                queryClient.refetchQueries({ queryKey: ['search'] });

                const sourceName = SOURCE_LABELS[finalSource] || 'ë“±ë¡ëœ ë§¤ë¬¼';
                alert(`${sourceName} ë§¤ë¬¼ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¸`);
                onClose();
            },
            onError: (err: Error) => {
                const error = err as AxiosError<ApiErrorResponse>;
                console.error('Failed to register item:', error);

                let errorMsg = 'ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                try {
                    const data = error.response?.data;
                    if (data) {
                        // JSON ë¬¸ìì—´ë¡œ ë³€í™˜ í›„ íŒŒì‹±
                        const jsonStr = JSON.stringify(data);
                        if (jsonStr.includes('ì´ë¯¸ ë“±ë¡ëœ')) {
                            errorMsg = 'ì´ë¯¸ ë“±ë¡ëœ ë§¤ë¬¼ì…ë‹ˆë‹¤.';
                        } else if (jsonStr.includes('í—ˆìš©ë˜ì§€ ì•Šì€')) {
                            errorMsg = 'í—ˆìš©ë˜ì§€ ì•Šì€ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.\n(ë®¬, ë²ˆê°œì¥í„°, ë‹¹ê·¼ë§ˆì¼“, ì¤‘ê³ ë‚˜ë¼ë§Œ ë“±ë¡ ê°€ëŠ¥)';
                        } else {
                            // ëª¨ë“  ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ì¶œ
                            const messages: string[] = [];
                            Object.values(data).forEach(value => {
                                if (Array.isArray(value)) {
                                    messages.push(...value.map(v => String(v)));
                                } else if (typeof value === 'string') {
                                    messages.push(value);
                                }
                            });
                            errorMsg = messages.join('\n') || 'ì…ë ¥ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        }
                    }
                } catch {
                    errorMsg = error.message || 'ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                }
                alert(errorMsg);
            }
        });
    };

    return (
        <motion.div
            className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
        >
            <motion.div
                className="w-full max-w-md bg-white rounded-2xl shadow-2xl p-6"
                initial={{ scale: 0.9, y: 20 }}
                animate={{ scale: 1, y: 0 }}
                exit={{ scale: 0.9, y: 20 }}
                onClick={(e) => e.stopPropagation()}
            >
                <div className="flex items-center justify-between mb-4">
                    <h2 className="text-xl font-bold text-stone-800">ë§¤ë¬¼ ë“±ë¡</h2>
                    <button
                        onClick={onClose}
                        className="w-8 h-8 rounded-full bg-stone-100 flex items-center justify-center text-stone-500 hover:bg-stone-200"
                    >
                        âœ•
                    </button>
                </div>

                {/* ì•…ê¸°ëª… í‘œì‹œ (ìë™) */}
                <div className="mb-4 p-3 bg-matcha-50 rounded-xl border border-matcha-100">
                    <p className="text-xs text-matcha-600 font-medium mb-1">ì•…ê¸°ëª…</p>
                    <p className="text-lg font-bold text-matcha-800">{query}</p>
                </div>

                <form onSubmit={handleSubmit} className="space-y-4">
                    {/* ê°€ê²© */}
                    <div>
                        <label className="block text-sm font-medium text-stone-700 mb-1.5">
                            ê°€ê²© (ì›)
                        </label>
                        <input
                            type="number"
                            value={price}
                            onChange={(e) => setPrice(e.target.value)}
                            className="w-full px-4 py-3 rounded-xl border border-stone-200 focus:border-matcha-400 focus:ring-2 focus:ring-matcha-100 outline-none transition-all"
                            placeholder="ì˜ˆ: 850000"
                            required
                        />
                    </div>

                    {/* ë§í¬ */}
                    <div>
                        <label className="block text-sm font-medium text-stone-700 mb-1.5">
                            ë§¤ë¬¼ ë§í¬
                        </label>
                        <input
                            type="text"
                            value={link}
                            onChange={(e) => setLink(e.target.value)}
                            className="w-full px-4 py-3 rounded-xl border border-stone-200 focus:border-matcha-400 focus:ring-2 focus:ring-matcha-100 outline-none transition-all"
                            placeholder="ì˜ˆ: mule.co.kr/..."
                            required
                        />

                        {/* URL ê°ì§€ ê²°ê³¼ í‘œì‹œ */}
                        {link.length > 5 && (
                            <motion.div
                                initial={{ opacity: 0, y: -5 }}
                                animate={{ opacity: 1, y: 0 }}
                                className={`mt-2 flex items-center gap-2 text-sm p-3 rounded-xl border ${SOURCE_COLORS[detectedSource]}`}
                            >
                                <span className="text-lg">
                                    {detectedSource === 'other' ? 'ğŸ”—' : 'âœ…'}
                                </span>
                                <span className="font-bold">
                                    {detectedSource === 'other'
                                        ? 'ì¶œì²˜ë¥¼ ê°ì§€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ê¸°íƒ€ë¡œ ë“±ë¡ë©ë‹ˆë‹¤)'
                                        : `${SOURCE_LABELS[detectedSource]} ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!`}
                                </span>
                            </motion.div>
                        )}
                    </div>

                    {/* ë²„íŠ¼ */}
                    <div className="flex gap-3 pt-2">
                        <button
                            type="button"
                            onClick={onClose}
                            className="flex-1 py-3 rounded-xl border border-stone-200 text-stone-600 font-medium hover:bg-stone-50 transition-colors"
                        >
                            ì·¨ì†Œ
                        </button>
                        <button
                            type="submit"
                            disabled={createUserItem.isPending}
                            className={`flex-1 py-3 rounded-xl text-white font-bold transition-all shadow-md active:scale-95 disabled:opacity-50 ${detectedSource !== 'other'
                                ? 'bg-matcha-600 hover:bg-matcha-700 hover:shadow-lg'
                                : 'bg-stone-500 hover:bg-stone-600'
                                }`}
                        >
                            {createUserItem.isPending ? 'ë“±ë¡ ì¤‘...' : 'ë“±ë¡í•˜ê¸°'}
                        </button>
                    </div>
                </form>
            </motion.div>
        </motion.div>
    );
}
</file>

<file path="src/services/api.ts">
/**
 * API client for MALCHA-DAGU backend
 */

import axios from 'axios';
import type { SearchResult, Instrument, UserItem, AIDescription } from '../types';

const api = axios.create({
    baseURL: '/api',
    headers: {
        'Content-Type': 'application/json',
    },
    withCredentials: true,  // SSO ì¿ í‚¤ ì „ì†¡ í•„ìˆ˜
});

// =============================================================================
// Search API
// =============================================================================

export async function search(query: string, display = 20): Promise<SearchResult> {
    const response = await api.get<SearchResult>('/search/', {
        params: { q: query, display },
    });
    return response.data;
}

export async function getPopularSearches(limit = 4): Promise<string[]> {
    const response = await api.get<{ terms: string[] }>('/popular-searches/', {
        params: { limit },
    });
    return response.data.terms;
}

// =============================================================================
// Instrument API
// =============================================================================

export async function getInstruments(params?: {
    brand?: string;
    category?: string;
    search?: string;
}): Promise<Instrument[]> {
    const response = await api.get<{ results: Instrument[] }>('/instruments/', { params });
    return response.data.results || response.data as unknown as Instrument[];
}

export async function getInstrument(id: string): Promise<Instrument> {
    const response = await api.get<Instrument>(`/instruments/${id}/`);
    return response.data;
}

// =============================================================================
// UserItem API
// =============================================================================

export async function getUserItems(params?: {
    instrument?: string;
    source?: string;
    min_price?: number;
    max_price?: number;
}): Promise<UserItem[]> {
    const response = await api.get<{ results: UserItem[] }>('/items/', { params });
    return response.data.results || response.data as unknown as UserItem[];
}

export async function createUserItem(data: {
    instrument?: string;
    price: number;
    link: string;
    source: string;
    title?: string;
}): Promise<UserItem> {
    // instrumentê°€ ì—†ê±°ë‚˜ ë¹ˆ ë¬¸ìì—´ì´ë©´ ì œê±°
    const payload = { ...data };
    if (!payload.instrument) {
        delete payload.instrument;
    }
    const response = await api.post<UserItem>('/items/', payload);
    return response.data;
}

export async function trackItemClick(id: string): Promise<UserItem> {
    const response = await api.post<UserItem>(`/items/${id}/click/`);
    return response.data;
}

export async function extendUserItem(id: string): Promise<UserItem> {
    const response = await api.post<UserItem>(`/items/${id}/extend/`);
    return response.data;
}

export async function reportUserItem(id: string, data: {
    reason: string;
    detail?: string;
}): Promise<{ message: string; report_count: number; is_under_review: boolean; is_deleted: boolean }> {
    const response = await api.post(`/items/${id}/report/`, data);
    return response.data;
}

export async function updateItemPrice(id: string, price: number): Promise<UserItem> {
    const response = await api.post<UserItem>(`/items/${id}/update_price/`, { price });
    return response.data;
}

// =============================================================================
// AI Description API
// =============================================================================

export async function getAIDescription(data: {
    model_name: string;
    brand: string;
    category: string;
}): Promise<AIDescription> {
    const response = await api.post<AIDescription>('/ai/describe/', data);
    return response.data;
}

export default api;
</file>

<file path="src/types/index.ts">
/**
 * Type definitions for MALCHA-DAGU
 */

// =============================================================================
// API Response Types
// =============================================================================

export interface Instrument {
    id: string;
    name: string;
    brand: string;
    category: string;
    category_display: string;
    image_url: string;
    reference_price: number;
    description: string;
    created_at: string;
    updated_at: string;
}

export interface UserItem {
    id: string;
    instrument: string;
    instrument_detail: {
        id: string;
        name: string;
        brand: string;
        image_url: string;
        reference_price: number;
    };
    price: number;
    link: string;
    source: string;
    source_display: string;
    title: string;
    is_active: boolean;
    expired_at: string;
    extended_at: string | null;
    click_count: number;
    discount_rate: number;
    is_expired: boolean;
    is_owner: boolean;
    owner_id: number | null;
    created_at: string;
    updated_at: string;
}

export interface NaverItem {
    title: string;
    link: string;
    image: string;
    lprice: number;
    hprice: number;
    mallName: string;
    productId: string;
    productType: number;
    source: 'naver';
}

export interface SearchResult {
    query: string;
    search_query: string;  // ì •ê·œí™”ëœ ê²€ìƒ‰ì–´ (ì™¸ë¶€ ë§í¬ìš©)
    total_count: number;
    reference: {
        name: string;
        price: number;
        image_url: string;
    } | null;
    items: (NaverItem | MergedUserItem)[];
    naver_items: NaverItem[];
    user_items: MergedUserItem[];
}

export interface MergedUserItem {
    id: string;
    title: string;
    link: string;
    image: string;
    lprice: number;
    source: string;
    source_display: string;
    discount_rate: number;
    instrument_id: string;
    instrument_name: string;
    instrument_brand: string;
    extended_at: string | null;
    report_count: number;
}

// ì‹ ê³  ì‚¬ìœ  íƒ€ì…
export type ReportReason = 'wrong_price' | 'sold_out' | 'fake' | 'inappropriate' | 'other';

export const REPORT_REASON_LABELS: Record<ReportReason, string> = {
    wrong_price: 'ê°€ê²©ì´ ë‹¤ë¦…ë‹ˆë‹¤',
    sold_out: 'ì´ë¯¸ íŒë§¤ì™„ë£Œëœ ë§¤ë¬¼ì…ë‹ˆë‹¤',
    fake: 'í—ˆìœ„/ì‚¬ê¸° ë§¤ë¬¼ì…ë‹ˆë‹¤',
    inappropriate: 'ë¶€ì ì ˆí•œ ë‚´ìš©ì…ë‹ˆë‹¤',
    other: 'ê¸°íƒ€',
};

export interface AIDescription {
    summary: string;
    check_point: string;
}

// =============================================================================
// Component Props Types
// =============================================================================

export interface SearchBarProps {
    onSearch: (query: string) => void;
    isLoading?: boolean;
    placeholder?: string;
}

export interface ItemCardProps {
    item: NaverItem | MergedUserItem;
    rank?: number;
    referencePrice?: number;
    onClick?: () => void;
    isOwner?: boolean;
    isLoggedIn?: boolean;
    onExtend?: () => void;
    onReport?: (reason: ReportReason, detail?: string) => void;
    onUpdatePrice?: (newPrice: number) => void;
}

export interface LoaderProps {
    isVisible: boolean;
    onComplete?: () => void;
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

// https://vite.dev/config/
export default defineConfig({
  plugins: [
    react(),
    tailwindcss(),
  ],
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8001',
        changeOrigin: true,
      },
    },
  },
})
</file>

</files>
